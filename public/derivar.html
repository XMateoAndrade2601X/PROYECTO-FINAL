<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Derivar Alerta</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f9f9f9;
    }
    h2 {
      color: #273c75;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .btn {
      margin-top: 20px;
      padding: 12px;
      background-color: #273c75;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      width: 100%;
    }
    .btn:hover {
      background-color: #40739e;
    }
  </style>
</head>
<body>
  <h2>Derivar Alerta</h2>

  <label>Nombre:</label>
  <input type="text" id="nombre" readonly>

  <label>Sexo de la v√≠ctima:</label>
  <input type="text" id="sexo" readonly>

  <label>Tel√©fono:</label>
  <input type="text" id="telefono" readonly>

  <label>Tipo de violencia:</label>
  <input type="text" id="tipo" readonly>

  <label>Agresor:</label>
  <input type="text" id="agresor" readonly>

  <label>Sexo del agresor:</label>
  <input type="text" id="sexoAgresor" readonly>

  <label>Mensaje capturado:</label>
  <textarea id="mensaje" readonly></textarea>

  <label>Descripci√≥n:</label>
  <textarea id="descripcion" readonly></textarea>

  <label>Ubicaci√≥n:</label>
  <input type="text" id="ubicacion" readonly>

  <label>Fecha:</label>
  <input type="text" id="fecha" readonly>

  <button class="btn" onclick="enviarCorreo()">üìß Enviar por Correo</button>
  <button class="btn" onclick="enviarWhatsapp()">üí¨ Enviar por WhatsApp</button>
  <button class="btn" onclick="llamadaTelefonica()">üìû Llamar</button>

  <script>
    const params = new URLSearchParams(location.search);
    const campos = [
      "nombre", "sexo", "telefono", "tipo", "agresor", "sexoAgresor",
      "mensaje", "descripcion", "ubicacion", "fecha"
    ];
    campos.forEach(id => {
      if (params.has(id)) {
        document.getElementById(id).value = decodeURIComponent(params.get(id));
      }
    });

    function getEntidad(tipo, sexo) {
      const cat = {
        "Violencia F√≠sica": {
          standard: { email: "cem@minmujer.gob.pe", whatsapp: "51941972600", tel√©fono: "105" }
        },
        "Violencia Psicol√≥gica": {
          standard: { email: "cem@minmujer.gob.pe", whatsapp: "51941972600", tel√©fono: "105" }
        },
        "Violencia Sexual": {
          Mujer: { email: "linea100@mimp.gob.pe", whatsapp: "51984141404", tel√©fono: "100" },
          Hombre: { email: "linea100@mimp.gob.pe", whatsapp: "51984141404", tel√©fono: "100" }
        },
        "Violencia Econ√≥mica": {
          standard: { email: "defensapublica@minjus.gob.pe", whatsapp: "51980152859", tel√©fono: "1884" }
        }
      };
      const e = cat[tipo];
      return e?.[sexo] || e?.standard || { email: "", whatsapp: "", tel√©fono: "" };
    }

    function enviarCorreo() {
      const sexo = document.getElementById("sexo").value;
      const tipo = document.getElementById("tipo").value;
      const entidad = getEntidad(tipo, sexo);
      const contenido = [
        `Nombre: ${document.getElementById("nombre").value}`,
        `Sexo de la v√≠ctima: ${sexo}`,
        `Tel√©fono: ${document.getElementById("telefono").value}`,
        `Tipo de violencia: ${tipo}`,
        `Agresor: ${document.getElementById("agresor").value}`,
        `Sexo del agresor: ${document.getElementById("sexoAgresor").value}`,
        `Descripci√≥n: ${document.getElementById("descripcion").value}`,
        `Mensaje capturado: ${document.getElementById("mensaje").value}`,
        `Ubicaci√≥n: ${document.getElementById("ubicacion").value}`,
        `Fecha: ${document.getElementById("fecha").value}`
      ].join("\n");

      const asunto = encodeURIComponent(`[Alerta] ${tipo} (${sexo})`);
      const body = encodeURIComponent(contenido);
      window.location.href = `mailto:${entidad.email}?subject=${asunto}&body=${body}`;
    }

    function enviarWhatsapp() {
      const sexo = document.getElementById("sexo").value;
      const tipo = document.getElementById("tipo").value;
      const entidad = getEntidad(tipo, sexo);
      const msg = [
        `üî¥ ALERTA DE VIOLENCIA üî¥`,
        `Tipo: ${tipo}`,
        `Sexo v√≠ctima: ${sexo}`,
        `Nombre: ${document.getElementById("nombre").value}`,
        `Tel√©fono: ${document.getElementById("telefono").value}`,
        `Agresor: ${document.getElementById("agresor").value}`,
        `Sexo del agresor: ${document.getElementById("sexoAgresor").value}`,
        `Descripci√≥n: ${document.getElementById("descripcion").value}`,
        `Mensaje: ${document.getElementById("mensaje").value}`,
        `Ubicaci√≥n: ${document.getElementById("ubicacion").value}`,
        `Fecha: ${document.getElementById("fecha").value}`
      ].join("\n");

      window.open(`https://wa.me/${entidad.whatsapp}?text=${encodeURIComponent(msg)}`, "_blank");
    }

    function llamadaTelefonica() {
      const sexo = document.getElementById("sexo").value;
      const tipo = document.getElementById("tipo").value;
      const entidad = getEntidad(tipo, sexo);
      window.location.href = `tel:${entidad.tel√©fono}`;
    }
  </script>
</body>
</html>
